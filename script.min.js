async function getGeo(){target.innerHTML=`<h1 style="padding-top:${screen.height/2.5}px; text-align:center;">Please Wait...</h1>`;var e=await fetch("./countries.geojson",{cache:"force-cache"}).then(e=>e.json()),t=e.features;window.geofeatures=t,target.removeChild(target.childNodes[0])}function showMap(e){var t=[e.coords.latitude,e.coords.longitude],o=e.coords.accuracy;initMap(t,o)}async function getLocName(e){return await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e.latlng.lat}&lon=${e.latlng.lng}&localityLanguage=id`).then(e=>e.json()).then(e=>e)}function getDistance(e,t){let o=e.lat,r=e.lng,a=t.lat,n=t.lng,i=6371e3,s=o*Math.PI/180,c=a*Math.PI/180,l=(a-o)*Math.PI/180,g=(n-r)*Math.PI/180,u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s)*Math.cos(c)*Math.sin(g/2)*Math.sin(g/2),d=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),p=i*d;return`${Math.round(p/1e3)} KM From Your Location`}async function setMark(e){let t=await getLocName(e);var o=t.display_name;o+=`<br>${getDistance(e.latlng,window.currentLoc)}`;let r=t.address.country_code;r=r.toUpperCase();let a=window.geofeatures.filter(e=>e.properties.ISO_A2==r);return[L.marker(e.latlng,{title:o}).bindPopup(`<b>${o}</b>`),a,r]}async function initMap(e,t){async function o(e){let t=await setMark(e,c),o=t[1],a=t[2];return t=t[0],t.addTo(r).on("contextmenu",function(e){r.removeLayer(this),r.flyTo(c._latlng,10)}),t.addTo(r).on("click",function(e){r.flyTo(e.latlng),this.openPopup()}),r.flyTo(e.latlng,9),sessionStorage.getItem("current_country")!=a&&(r.removeLayer(s),s=L.geoJSON(o,{style:styles}).addTo(r),sessionStorage.setItem("current_country",a)),t.openPopup()}await getGeo();var r=L.map(target,{center:e,zoom:9,retina:!0,minZoom:2,maxZoom:14}),a=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),n=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"}).addTo(r),i={"Street Map":n,"World Image":a};L.control.layers(i).addTo(r);var s=L.geoJSON().addTo(r);null!=sessionStorage.getItem("current_country")&&(r.removeLayer(s),s.setStyle(styles),s=L.geoJSON(window.geofeatures.filter(e=>e.properties.ISO_A2==sessionStorage.getItem("current_country")),{style:styles}).addTo(r));var c=L.circle(e,{color:"#0022ff",fillColor:"#00ccff",fillOpacity:1,radius:28e3/r.getZoom()}).bindPopup("<b>You Are Here</b>");L.circle(e,{color:"red",fillColor:"#0099ff",fillOpacity:.2,radius:t}).addTo(r);window.currentLoc=c._latlng,c.on("click",function(e){r.flyTo(e.latlng),this.openPopup()}),c.addTo(r),r.on("click",o),r.on("zoom",function(e){c.setRadius(28e3/r.getZoom())})}var styles={opacity:.5,color:"#e4f"},target=document.querySelector("#map");navigator.geolocation?navigator.geolocation.getCurrentPosition(showMap):target.innerHTML=`<h1 style="padding-top:${screen.height/2.5}px; text-align:center;">No Geolocation Support</h1>`;